<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Chosen Palette: Calm Harmony -->
    <!-- Application Structure Plan: This updated version retains the non-linear, dashboard-style SPA structure but expands it with two new dedicated sections for self-assessment and further study. The navigation now includes 'Exercícios' and 'Referências'. This evolution transforms the application from a pure exploratory tool into a complete learning module. The core design philosophy remains: allow users to freely connect concepts. However, the new sections provide structured paths for reinforcing knowledge (Exercícios) and deepening it (Referências), catering to a more comprehensive educational workflow. Visual aids like tables and diagrams have been added to existing sections to reduce cognitive load and make data more accessible. -->
    <!-- Visualization & Content Choices: 
        - New Feature: Exercícios Section -> Goal: Assess/Reinforce -> Viz: Interactive Q&A cards -> Interaction: Buttons to reveal answers and explanations. -> Justification: Active recall is a powerful learning technique. This provides immediate feedback, solidifying concepts.
        - New Feature: Referências Section -> Goal: Guide/Extend -> Viz: Structured, categorized list -> Interaction: None (informational). -> Justification: Provides a curated path for students to continue their research beyond the application's scope.
        - Enhancement: Limiares Section -> Viz: Added a dB scale table. -> Justification: Provides real-world context to abstract dB values.
        - Enhancement: Organização Section -> Viz: Added a diagram for Roederer's Time Scales. -> Justification: Visually clarifies the hierarchical nature of temporal perception.
        - Enhancement: Espaço Section -> Viz: Added a diagram for the 'Cone of Confusion'. -> Justification: Introduces a key challenge in spatial hearing (vertical/front-back localization) that ITD/ILD alone cannot solve.
        - CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. All visuals are rendered on HTML Canvas via Chart.js or built with styled HTML/CSS. All audio is generated by Tone.js.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <title>Psicoacústica: A Arquitetura da Audição Musical</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F8F5F2;
            color: #434242;
        }
        .nav-button {
            transition: all 0.3s ease;
            border-bottom: 2px solid transparent;
            padding-bottom: 4px;
        }
        .nav-button.active, .nav-button:hover {
            color: #2D2D2D;
            border-bottom-color: #B3A492;
        }
        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .card {
            background-color: #FFFFFF;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            padding: 1.5rem;
            border: 1px solid #E5E0DA;
        }
        .chart-container {
            position: relative;
            width: 100%;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #B3A492;
            cursor: pointer;
            border-radius: 50%;
        }
        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #B3A492;
            cursor: pointer;
            border-radius: 50%;
        }
        .answer-key {
            display: none;
        }
    </style>
</head>
<body class="antialiased">

    <header class="bg-white/80 backdrop-blur-md shadow-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col sm:flex-row justify-between items-center py-4">
                <h1 class="text-xl md:text-2xl font-bold text-gray-800 text-center sm:text-left">Psicoacústica: A Arquitetura da Audição</h1>
                <nav class="mt-4 sm:mt-0">
                    <ul class="flex flex-wrap justify-center space-x-3 md:space-x-4 text-sm md:text-base">
                        <li><button class="nav-button active" data-target="limiares">Limiares</button></li>
                        <li><button class="nav-button" data-target="timbre">Timbre</button></li>
                        <li><button class="nav-button" data-target="organizacao">Organização</button></li>
                        <li><button class="nav-button" data-target="interferencia">Interferência</button></li>
                        <li><button class="nav-button" data-target="espaco">Espaço</button></li>
                        <li><button class="nav-button" data-target="exercicios">Exercícios</button></li>
                        <li><button class="nav-button" data-target="referencias">Referências</button></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">

        <!-- Seção Limiares -->
        <section id="limiares" class="content-section active">
            <h2 class="text-3xl font-bold mb-2">Os Limites da Audição</h2>
            <p class="text-lg text-gray-600 mb-8">Nossa percepção do mundo sonoro é definida por duas fronteiras: o som mais suave que podemos ouvir e o mais alto que podemos suportar. Esta seção explora o mapa do nosso campo auditivo, um território onde a sensibilidade varia drasticamente com a frequência e a intensidade.</p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="card">
                    <h3 class="text-xl font-bold mb-2">Curvas de Igual-Loudness (ISO 226:2003)</h3>
                    <p class="text-sm text-gray-500 mb-4">Nossa sensibilidade não é uniforme. Sons com a mesma energia física (dB SPL) são percebidos com intensidades (loudness) diferentes dependendo da frequência. Mova o controle deslizante para ver como as curvas de igual-loudness (em <span class="font-bold">phons</span>) mudam. Observe como nossa audição é mais sensível na região de 2 a 5 kHz e como as curvas se "aplainam" em volumes mais altos.</p>
                    <div class="chart-container mx-auto max-w-xl">
                        <canvas id="loudnessChart"></canvas>
                    </div>
                    <div class="mt-4">
                        <label for="phonSlider" class="block text-sm font-medium text-gray-700">Nível de Loudness: <span id="phonValue" class="font-bold">60</span> phons</label>
                        <input id="phonSlider" type="range" min="10" max="100" value="60" step="10" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider">
                    </div>
                </div>
                <div class="card">
                    <h3 class="text-xl font-bold mb-2">O Campo Auditivo e Exemplos</h3>
                    <p class="text-sm text-gray-500 mb-4">O Limiar de Audibilidade (base) e o Limiar de Dor (teto) definem nosso universo sonoro. Veja abaixo uma escala de níveis de pressão sonora (dB SPL) para contextualizar esses limites.</p>
                     <div class="relative w-full h-auto bg-gray-50 rounded-lg p-4 flex flex-col justify-between">
                        <div class="text-center font-bold text-red-600">
                            <p>Limiar de Dor</p>
                            <div class="w-full h-0.5 bg-red-500 mt-1"></div>
                        </div>
                        <div class="my-4 space-y-2">
                            <p class="flex justify-between"><span>Motor a Jato (a 30m)</span> <span class="font-bold text-red-700">140 dB</span></p>
                            <p class="flex justify-between"><span>Show de Rock (pico)</span> <span class="font-bold text-orange-600">120 dB</span></p>
                            <p class="flex justify-between"><span>Motocicleta</span> <span class="font-bold text-yellow-600">100 dB</span></p>
                            <p class="flex justify-between"><span>Tráfego Intenso</span> <span class="font-bold text-green-700">85 dB</span></p>
                            <p class="flex justify-between"><span>Conversa Normal</span> <span class="font-bold text-blue-600">60 dB</span></p>
                            <p class="flex justify-between"><span>Biblioteca Silenciosa</span> <span class="font-bold text-cyan-600">40 dB</span></p>
                            <p class="flex justify-between"><span>Sussurro</span> <span class="font-bold text-purple-600">20 dB</span></p>
                        </div>
                        <div class="text-center font-bold text-blue-600">
                            <div class="w-full h-0.5 bg-blue-500 mb-1"></div>
                            <p>Limiar de Audibilidade</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Seção Timbre -->
        <section id="timbre" class="content-section">
            <h2 class="text-3xl font-bold mb-2">A Identidade do Som</h2>
             <p class="text-lg text-gray-600 mb-8">O que faz um piano soar como um piano e uma flauta como uma flauta, mesmo tocando a mesma nota? O timbre é a "impressão digital" do som, uma qualidade multidimensional definida pela interação complexa entre espectro, tempo e inarmonicidade.</p>
            <div class="grid grid-cols-1 md:grid-cols-5 gap-8">
                <div class="md:col-span-2 card">
                    <h3 class="text-xl font-bold mb-4">Os Parâmetros do Timbre</h3>
                     <div id="timbre-tabs" class="space-y-4">
                        <div>
                            <button class="w-full text-left font-bold p-3 bg-gray-100 rounded-lg focus:outline-none" data-param="espectral">Distribuição Espectral</button>
                            <div id="content-espectral" class="mt-2 text-sm text-gray-600">O número e a amplitude relativa dos parciais acima da fundamental. O <span class="font-semibold">centroide espectral</span> (a "média" do espectro) correlaciona-se com o <span class="font-semibold">brilho</span>. Compositores espectralistas como Grisey orquestram o espectro de um único som.</div>
                        </div>
                        <div>
                            <button class="w-full text-left font-bold p-3 bg-gray-50 rounded-lg focus:outline-none" data-param="temporal">Envolvente Temporal</button>
                            <div id="content-temporal" class="hidden mt-2 text-sm text-gray-600">A evolução da amplitude no tempo (ADSR: Attack, Decay, Sustain, Release). O <span class="font-semibold">ataque</span> é um dos indicadores mais poderosos para a identificação de um instrumento. Um som de piano com o ataque de um violino se torna irreconhecível.</div>
                        </div>
                        <div>
                            <button class="w-full text-left font-bold p-3 bg-gray-50 rounded-lg focus:outline-none" data-param="inarmonicidade">Inarmonicidade</button>
                            <div id="content-inarmonicidade" class="hidden mt-2 text-sm text-gray-600">A leve desafinação dos parciais em relação a múltiplos inteiros da fundamental. Essencial para o "calor" de instrumentos como o piano e para o caráter de sinos e gamelão.</div>
                        </div>
                    </div>
                </div>
                <div class="md:col-span-3 card">
                     <h3 class="text-xl font-bold mb-2">Trajetória Tímbrica (Tristimulus)</h3>
                     <p class="text-sm text-gray-500 mb-4">Podemos visualizar a evolução de um timbre no tempo plotando sua energia em três blocos: T1 (Fundamental), T2 (Médios) e T3 (Agudos). Selecione um instrumento para ver sua "assinatura" dinâmica. Note como sons percussivos (Piano, Prato) iniciam na região T3 (rica em agudos) e se movem rapidamente.</p>
                    <div class="chart-container mx-auto max-w-xl">
                        <canvas id="tristimulusChart"></canvas>
                    </div>
                    <div class="mt-4">
                        <label for="instrumentSelect" class="block text-sm font-medium text-gray-700">Selecione o Instrumento:</label>
                        <select id="instrumentSelect" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                            <option value="piano">Piano</option>
                            <option value="flauta">Flauta</option>
                            <option value="violino">Violino</option>
                            <option value="prato">Prato</option>
                        </select>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Seção Organização -->
        <section id="organizacao" class="content-section">
            <h2 class="text-3xl font-bold mb-2">Organizando a Cena Auditiva</h2>
            <p class="text-lg text-gray-600 mb-8">O mundo é acusticamente caótico. Nosso cérebro executa a tarefa notável de organizar essa cacofonia em fontes sonoras coerentes. Esta seção aborda como focamos nossa atenção (o Efeito Cocktail Party) e como processamos informações em diferentes escalas de tempo.</p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="card">
                    <h3 class="text-xl font-bold mb-2">Demonstração: Efeito Cocktail Party</h3>
                    <p class="text-sm text-gray-500 mb-4">A sua capacidade de focar em uma única conversa em uma festa barulhenta é um milagre da computação neural. A localização espacial (pistas binaurais) é a chave. Ouça a dificuldade de seguir uma voz em uma mixagem mono versus uma estéreo.</p>
                    <div class="mt-4 space-y-4">
                        <div>
                            <p class="font-semibold mb-2">1. Mixagem MONO (Sem pistas espaciais)</p>
                            <button id="playMono" class="w-full bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded inline-flex items-center justify-center">
                                ▶️ Tentar Seguir uma Voz
                            </button>
                        </div>
                        <div>
                            <p class="font-semibold mb-2">2. Mixagem ESTÉREO (Com pistas espaciais)</p>
                            <button id="playStereo" class="w-full bg-blue-100 hover:bg-blue-200 text-blue-800 font-bold py-2 px-4 rounded inline-flex items-center justify-center">
                                ▶️ Tarefa Muito Mais Fácil
                            </button>
                        </div>
                         <button id="stopAudio" class="w-full bg-red-100 hover:bg-red-200 text-red-800 font-bold py-2 px-4 rounded inline-flex items-center justify-center mt-4">
                                ⏹️ Parar Áudio
                         </button>
                    </div>
                    <p class="text-xs text-gray-400 mt-4">Demonstração sonora usando múltiplas faixas de fala sintetizada. A separação espacial (panning) no modo estéreo permite que o cérebro segregue as fontes com eficácia.</p>
                </div>
                 <div class="card">
                    <h3 class="text-xl font-bold mb-2">Escalas de Tempo de Roederer</h3>
                    <p class="text-sm text-gray-500 mb-4">Nossa percepção opera em três níveis simultâneos, desde a textura do som até a forma musical completa.</p>
                    <div class="mt-4 space-y-2">
                        <div class="p-3 bg-gray-50 rounded-lg">
                            <p class="font-bold text-sm">3. Escala Macroscópica <span class="font-normal text-xs">(segundos a minutos)</span></p>
                            <p class="text-xs text-center font-semibold text-gray-600 mt-1">FORMA MUSICAL</p>
                        </div>
                        <div class="pl-4 border-l-2 border-gray-300">
                            <div class="p-3 bg-gray-50 rounded-lg">
                                <p class="font-bold text-sm">2. Escala Intermediária <span class="font-normal text-xs">(~20ms a segs)</span></p>
                                <p class="text-xs text-center font-semibold text-gray-600 mt-1">RITMO, MELODIA, EVENTOS</p>
                            </div>
                            <div class="pl-4 border-l-2 border-gray-300">
                                <div class="p-3 bg-gray-50 rounded-lg">
                                    <p class="font-bold text-sm">1. Escala Microscópica <span class="font-normal text-xs">(< 20ms)</span></p>
                                    <p class="text-xs text-center font-semibold text-gray-600 mt-1">TIMBRE, ALTURA</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <p class="text-xs text-gray-400 mt-4">Obras como <i>Atmosphères</i> de Ligeti forçam uma escuta macroscópica, onde a evolução da textura se torna o conteúdo principal.</p>
                </div>
            </div>
        </section>
        
        <!-- Seção Interferência -->
        <section id="interferencia" class="content-section">
            <h2 class="text-3xl font-bold mb-2">O Jogo de Sombras Auditivo</h2>
            <p class="text-lg text-gray-600 mb-8">Sons não existem isoladamente; eles interagem e afetam a percepção um do outro. Esta seção investiga a base fisiológica da dissonância e como sons mais fortes podem tornar outros completamente inaudíveis — um princípio fundamental para a tecnologia de compressão de áudio.</p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="card">
                    <h3 class="text-xl font-bold mb-2">Consonância e a Banda Crítica</h3>
                     <p class="text-sm text-gray-500 mb-4">A dissonância sensorial (aspereza) surge da interferência de sons na membrana basilar. A aspereza é máxima quando dois tons estão separados por ~1/4 da <span class="font-semibold">banda crítica</span>. Arraste o controle para ouvir e ver essa relação.</p>
                    <div class="chart-container mx-auto max-w-xl">
                        <canvas id="dissonanceChart"></canvas>
                    </div>
                     <div class="mt-4">
                        <label for="dissonanceSlider" class="block text-sm font-medium text-gray-700">Diferença de Frequência (Tom Base: 500 Hz): <span id="dissonanceValue" class="font-bold">5</span> Hz</label>
                        <input id="dissonanceSlider" type="range" min="1" max="200" value="5" step="1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider">
                         <button id="playDissonance" class="mt-4 w-full bg-green-100 hover:bg-green-200 text-green-800 font-bold py-2 px-4 rounded inline-flex items-center justify-center">
                                ▶️ Ouvir o Intervalo
                         </button>
                    </div>
                </div>
                <div class="card">
                    <h3 class="text-xl font-bold mb-2">O Efeito de Máscara</h3>
                    <p class="text-sm text-gray-500 mb-4">Um som alto pode tornar outro, mais fraco e próximo em frequência, inaudível. Este é o princípio por trás do MP3. Os sons graves são mascaradores especialmente eficazes de sons agudos ("propagação ascendente da máscara").</p>
                    <div class="mt-4 p-4 border border-gray-200 rounded-lg">
                        <p class="font-semibold mb-2">Demonstração de Máscara Simultânea:</p>
                        <div class="space-y-3">
                            <button id="playSignal" class="w-full bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded">1. Ouvir o Sinal (Tom agudo fraco)</button>
                            <button id="playSignalAndMask" class="w-full bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded">2. Ouvir Sinal + Mascarador (Tom grave forte)</button>
                             <button id="stopMaskAudio" class="w-full bg-red-100 hover:bg-red-200 text-red-800 font-bold py-2 px-4 rounded mt-2">⏹️ Parar</button>
                        </div>
                         <p id="maskResult" class="mt-3 text-sm text-center font-semibold text-red-600 h-5"></p>
                    </div>
                    <p class="text-xs text-gray-400 mt-4">Na segunda audição, o tom agudo fraco se torna muito difícil ou impossível de ouvir, pois é "mascarado" pela energia do tom grave.</p>
                </div>
            </div>
        </section>
        
        <!-- Seção Espaço -->
        <section id="espaco" class="content-section">
            <h2 class="text-3xl font-bold mb-2">Construindo o Palco Sonoro</h2>
            <p class="text-lg text-gray-600 mb-8">Nossa capacidade de localizar sons é uma façanha computacional baseada em ter dois ouvidos. O cérebro analisa diferenças minúsculas de tempo e nível para construir um mapa tridimensional do nosso ambiente acústico. Essas pistas são a base de toda a tecnologia de gravação estéreo.</p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="card">
                    <h3 class="text-xl font-bold mb-2">Pistas Binaurais e o Cone de Confusão</h3>
                    <p class="text-sm text-gray-500 mb-4">A <span class="font-semibold">Teoria Duplex</span> (ITD para baixas frequências, ILD para altas) explica a localização horizontal. No entanto, pontos em um "cone de confusão" (veja diagrama) produzem os mesmos valores de ITD e ILD, tornando a localização vertical e frente-trás mais ambígua. Movimentos da cabeça e a forma de nossas orelhas (pavilhão auricular) ajudam a resolver essa ambiguidade.</p>
                    <div class="w-full text-center my-4">
                        <div class="relative inline-block">
                            <span class="text-6xl">👤</span>
                            <div class="absolute inset-0 flex items-center justify-center">
                                <div class="w-40 h-40 border-2 border-dashed border-gray-400 rounded-full" style="transform: perspective(100px) rotateX(70deg);"></div>
                            </div>
                            <span class="absolute text-xs font-bold" style="top: 50%; left: -20px; transform: translateY(-50%);">Frente</span>
                            <span class="absolute text-xs font-bold" style="top: 0; left: 50%; transform: translateX(-50%);">Cima</span>
                            <span class="absolute text-xs font-bold" style="top: 50%; right: -20px; transform: translateY(-50%);">Atrás</span>
                        </div>
                        <p class="text-xs text-gray-500 mt-2">Ilustração do Cone de Confusão</p>
                    </div>
                </div>
                <div class="card">
                    <h3 class="text-xl font-bold mb-2">Demonstração: O Poder do ITD</h3>
                    <p class="text-sm text-gray-500 mb-4">Experimente como um atraso minúsculo entre os canais esquerdo e direito move a imagem sonora percebida de um clique. Nosso cérebro interpreta essa diferença de tempo como uma mudança de posição.</p>
                    <div class="mt-4">
                        <div class="w-full text-center mb-4">
                            <div class="relative inline-block">
                                <span class="text-4xl">👤</span>
                                <div id="soundSourceIndicator" class="absolute -top-4 w-4 h-4 bg-green-500 rounded-full transition-all duration-200" style="left: 50%; transform: translateX(-50%);"></div>
                            </div>
                             <p class="text-sm font-semibold mt-2">Posição Percebida: <span id="itdPosition">Centro</span></p>
                        </div>
                        <label for="itdSlider" class="block text-sm font-medium text-gray-700">Atraso Interaural (ITD): <span id="itdValue" class="font-bold">0</span> ms</label>
                        <input id="itdSlider" type="range" min="-1" max="1" value="0" step="0.05" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider">
                        <button id="playITD" class="mt-4 w-full bg-purple-100 hover:bg-purple-200 text-purple-800 font-bold py-2 px-4 rounded">▶️ Ouvir o Clique</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Seção Exercícios -->
        <section id="exercicios" class="content-section">
            <h2 class="text-3xl font-bold mb-2">Exercícios de Fixação</h2>
            <p class="text-lg text-gray-600 mb-8">Teste seus conhecimentos sobre os conceitos apresentados. Para cada pergunta, selecione a resposta que julgar correta e depois clique para revelar a chave de correção e o comentário.</p>
            <div class="space-y-6">
                <!-- Pergunta 1 -->
                <div class="card quiz-card">
                    <p class="font-bold">1. De acordo com as curvas de igual-loudness (ISO 226), em qual faixa de frequência o ouvido humano é mais sensível?</p>
                    <div class="mt-2 space-y-1">
                        <label><input type="radio" name="q1" value="a"> a) 20 Hz - 100 Hz</label><br>
                        <label><input type="radio" name="q1" value="b"> b) 200 Hz - 500 Hz</label><br>
                        <label><input type="radio" name="q1" value="c"> c) 2 kHz - 5 kHz</label><br>
                        <label><input type="radio" name="q1" value="d"> d) 10 kHz - 15 kHz</label>
                    </div>
                    <button class="reveal-answer mt-4 bg-gray-200 text-sm font-bold py-2 px-4 rounded">Revelar Resposta</button>
                    <div class="answer-key mt-3 p-3 bg-green-50 border border-green-200 rounded">
                        <p><span class="font-bold">Resposta Correta: c) 2 kHz - 5 kHz.</span></p>
                        <p class="text-sm">Comentário: Esta é a região de maior sensibilidade, em parte devido à ressonância do canal auditivo. É também a faixa de frequência crucial para a inteligibilidade da fala.</p>
                    </div>
                </div>
                <!-- Pergunta 2 -->
                <div class="card quiz-card">
                    <p class="font-bold">2. Qual dos seguintes parâmetros NÃO é considerado uma dimensão primária do timbre?</p>
                    <div class="mt-2 space-y-1">
                        <label><input type="radio" name="q2" value="a"> a) Distribuição Espectral</label><br>
                        <label><input type="radio" name="q2" value="b"> b) Envolvente Temporal</label><br>
                        <label><input type="radio" name="q2" value="c"> c) Altura (Pitch)</label><br>
                        <label><input type="radio" name="q2" value="d"> d) Inarmonicidade</label>
                    </div>
                    <button class="reveal-answer mt-4 bg-gray-200 text-sm font-bold py-2 px-4 rounded">Revelar Resposta</button>
                    <div class="answer-key mt-3 p-3 bg-green-50 border border-green-200 rounded">
                        <p><span class="font-bold">Resposta Correta: c) Altura (Pitch).</span></p>
                        <p class="text-sm">Comentário: O timbre é, por definição, o que nos permite diferenciar sons que têm a *mesma* altura e intensidade. Portanto, a altura é um atributo separado do timbre.</p>
                    </div>
                </div>
                <!-- Pergunta 3 -->
                <div class="card quiz-card">
                    <p class="font-bold">3. O "Efeito Cocktail Party" depende crucialmente de:</p>
                    <div class="mt-2 space-y-1">
                        <label><input type="radio" name="q3" value="a"> a) O volume absoluto do ambiente.</label><br>
                        <label><input type="radio" name="q3" value="b"> b) A capacidade de ler lábios.</label><br>
                        <label><input type="radio" name="q3" value="c"> c) Pistas binaurais como ITD e ILD.</label><br>
                        <label><input type="radio" name="q3" value="d"> d) A familiaridade com a música de fundo.</label>
                    </div>
                    <button class="reveal-answer mt-4 bg-gray-200 text-sm font-bold py-2 px-4 rounded">Revelar Resposta</button>
                    <div class="answer-key mt-3 p-3 bg-green-50 border border-green-200 rounded">
                        <p><span class="font-bold">Resposta Correta: c) Pistas binaurais como ITD e ILD.</span></p>
                        <p class="text-sm">Comentário: A capacidade de localizar fontes sonoras no espaço, usando as diferenças de tempo e nível entre os dois ouvidos, é o principal mecanismo que permite ao cérebro separar uma fonte de interesse do ruído de fundo.</p>
                    </div>
                </div>
                 <!-- Pergunta 4 -->
                <div class="card quiz-card">
                    <p class="font-bold">4. A sensação de aspereza (dissonância sensorial) entre dois tons é máxima quando a diferença de frequência entre eles é de aproximadamente:</p>
                    <div class="mt-2 space-y-1">
                        <label><input type="radio" name="q4" value="a"> a) Zero (uníssono).</label><br>
                        <label><input type="radio" name="q4" value="b"> b) 1/4 da largura da banda crítica.</label><br>
                        <label><input type="radio" name="q4" value="c"> c) A largura exata da banda crítica.</label><br>
                        <label><input type="radio" name="q4" value="d"> d) O dobro da largura da banda crítica.</label>
                    </div>
                    <button class="reveal-answer mt-4 bg-gray-200 text-sm font-bold py-2 px-4 rounded">Revelar Resposta</button>
                    <div class="answer-key mt-3 p-3 bg-green-50 border border-green-200 rounded">
                        <p><span class="font-bold">Resposta Correta: b) 1/4 da largura da banda crítica.</span></p>
                        <p class="text-sm">Comentário: Este é o ponto de máxima interferência na membrana basilar, conforme demonstrado por Plomp & Levelt. Em uníssono não há aspereza, e quando a separação excede a banda crítica, a aspereza desaparece.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Seção Referências -->
        <section id="referencias" class="content-section">
            <h2 class="text-3xl font-bold mb-2">Referências para Aprofundamento</h2>
            <p class="text-lg text-gray-600 mb-8">Uma seleção de obras clássicas, canônicas e atuais para expandir seu conhecimento sobre a percepção musical e a psicoacústica.</p>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div class="card">
                    <h3 class="text-lg font-bold mb-2">Fundamentos Clássicos</h3>
                    <ul class="list-disc list-inside text-sm space-y-2">
                        <li><span class="font-semibold">Moore, B. C. J.</span> (2012). *An Introduction to the Psychology of Hearing*. Brill.</li>
                        <li><span class="font-semibold">Zwicker, E., & Fastl, H.</span> (1999). *Psychoacoustics: Facts and Models*. Springer.</li>
                        <li><span class="font-semibold">Blauert, J.</span> (1997). *Spatial Hearing: The Psychophysics of Human Sound Localization*. MIT Press.</li>
                        <li><span class="font-semibold">Bregman, A. S.</span> (1990). *Auditory Scene Analysis: The Perceptual Organization of Sound*. MIT Press.</li>
                    </ul>
                </div>
                <div class="card">
                    <h3 class="text-lg font-bold mb-2">Aplicações em Composição e Análise</h3>
                    <ul class="list-disc list-inside text-sm space-y-2">
                        <li><span class="font-semibold">Sethares, W. A.</span> (2005). *Tuning, Timbre, Spectrum, Scale*. Springer.</li>
                        <li><span class="font-semibold">Roederer, J. G.</span> (2008). *The Physics and Psychophysics of Music: An Introduction*. Springer.</li>
                        <li><span class="font-semibold">Tenney, J.</span> (1988). *A History of 'Consonance' and 'Dissonance'*. Excelsior Music Publishing Company.</li>
                        <li><span class="font-semibold">Grisey, G.</span> (1987). "Tempus ex machina: a composer's reflections on musical time." *Contemporary Music Review*, 2(1), 239-275.</li>
                    </ul>
                </div>
                <div class="card">
                    <h3 class="text-lg font-bold mb-2">Tecnologia, Síntese e Artigos-Chave</h3>
                    <ul class="list-disc list-inside text-sm space-y-2">
                        <li><span class="font-semibold">Plomp, R., & Levelt, W. J. M.</span> (1965). "Tonal consonance and critical bandwidth". *JASA*, 38(4), 548-560.</li>
                        <li><span class="font-semibold">Cherry, E. C.</span> (1953). "Some experiments on the recognition of speech...". *JASA*, 25(5), 975-979.</li>
                        <li><span class="font-semibold">Pollard, H. F., & Jansson, E. V.</span> (1982). "A tristimulus method for the specification of musical timbre". *Acustica*, 51(3), 162-171.</li>
                        <li><span class="font-semibold">Brandenburg, K.</span> (1999). "MP3 and AAC explained". *AES 17th International Conference: High-Quality Audio Coding*.</li>
                    </ul>
                </div>
            </div>
        </section>

    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const navButtons = document.querySelectorAll('.nav-button');
            const contentSections = document.querySelectorAll('.content-section');
            let loudnessChart, tristimulusChart, dissonanceChart;
            let audioContext, audioSources = [];
            let dissonanceSynth, dissonanceBaseFreq = 500;
            let maskSignal, maskNoise, maskStopTimer;
            let itdPlayer, itdIndicator, itdPositionEl, itdSliderEl;

            // Navegação principal
            navButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const target = button.dataset.target;

                    navButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');

                    contentSections.forEach(section => {
                        section.classList.toggle('active', section.id === target);
                    });
                });
            });
            
            // Lógica dos Exercícios
            const quizCards = document.querySelectorAll('.quiz-card');
            quizCards.forEach(card => {
                const revealButton = card.querySelector('.reveal-answer');
                const answerKey = card.querySelector('.answer-key');
                revealButton.addEventListener('click', () => {
                    answerKey.style.display = 'block';
                });
            });

            // Funções de inicialização (mantidas da versão anterior)
            function initLoudnessChart() {
                const loudnessSection = document.getElementById('limiares');
                if (!loudnessSection.classList.contains('active')) return;
                const canvas = document.getElementById('loudnessChart');
                if (canvas.chart) return; // Already initialized

                const ctx = canvas.getContext('2d');
                const phonSlider = document.getElementById('phonSlider');
                const phonValue = document.getElementById('phonValue');

                const iso226Data = {
                    freqs: [20, 25, 31.5, 40, 50, 63, 80, 100, 125, 160, 200, 250, 315, 400, 500, 630, 800, 1000, 1250, 1600, 2000, 2500, 3150, 4000, 5000, 6300, 8000, 10000, 12500],
                    getDbSpl: function(phon, freq) {
                        const f = freq;
                        const p = phon;
                        const af = 0.532 * ( (1.25*Math.exp(-0.15*Math.log(f/1000)**2)) * (Math.exp(0.15*Math.log(f/1000)**2) - 4.5*10**-4 * (f/1000)**2)**-0.5 + 4.5*10**-4 * (f/1000)**2 )**0.5;
                        const Lu = -0.7*p + 0.15*p**2/(1+(f/1000)**(-1.6));
                        const Tf = 4.47*10**-3 * (10**(0.074*p) - 1.15) + (0.4*10**((9+Lu)/10))**af;
                        return 10*Math.log10(Tf/ (2*10**-5)**2) * (1 - 10**(-0.15*(10*Math.log10(Tf/(2*10**-5)**2)-94)));
                    }
                };
                
                function updateLoudnessChart(phon) {
                    const dbValues = iso226Data.freqs.map(f => iso226Data.getDbSpl(phon, f));
                    loudnessChart.data.datasets[0].data = dbValues;
                    loudnessChart.update();
                    phonValue.textContent = phon;
                }

                loudnessChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: iso226Data.freqs,
                        datasets: [{ data: [], borderColor: '#B3A492', backgroundColor: 'rgba(179, 164, 146, 0.2)', fill: true, tension: 0.4 }]
                    },
                    options: {
                        responsive: true, maintainAspectRatio: false,
                        scales: { x: { type: 'logarithmic', title: { display: true, text: 'Frequência (Hz)' } }, y: { title: { display: true, text: 'Nível de Pressão Sonora (dB SPL)' }, min: -10, max: 140 } },
                        plugins: { legend: { display: false } }
                    }
                });
                canvas.chart = loudnessChart;
                phonSlider.addEventListener('input', (e) => updateLoudnessChart(parseInt(e.target.value)));
                updateLoudnessChart(60);
            }
            
            function initTimbre() {
                const timbreSection = document.getElementById('timbre');
                if (!timbreSection.classList.contains('active')) return;
                const canvas = document.getElementById('tristimulusChart');
                if (canvas.chart) return;

                const timbreTabs = document.querySelectorAll('#timbre-tabs button');
                timbreTabs.forEach(tab => {
                    tab.addEventListener('click', () => {
                        const param = tab.dataset.param;
                        document.getElementById('content-espectral').classList.add('hidden');
                        document.getElementById('content-temporal').classList.add('hidden');
                        document.getElementById('content-inarmonicidade').classList.add('hidden');
                        document.getElementById(`content-${param}`).classList.remove('hidden');
                        timbreTabs.forEach(t => t.classList.replace('bg-gray-100', 'bg-gray-50'));
                        tab.classList.replace('bg-gray-50','bg-gray-100');
                    });
                });

                const tristimulusData = {
                    piano: [{x:0.8, y:0.1}, {x:0.6, y:0.25}, {x:0.5, y:0.3}, {x:0.45, y:0.3}],
                    flauta: [{x:0.1, y:0.8}, {x:0.15, y:0.7}, {x:0.2, y:0.6}],
                    violino: [{x:0.2, y:0.6}, {x:0.3, y:0.5}, {x:0.4, y:0.45}, {x:0.4, y:0.4}],
                    prato: [{x:0.8, y:0.1}, {x:0.6, y:0.15}, {x:0.4, y:0.2}, {x:0.3, y:0.25}, {x:0.25, y:0.2}]
                };

                const tristimulusCtx = canvas.getContext('2d');
                tristimulusChart = new Chart(tristimulusCtx, {
                    type: 'scatter',
                    data: {
                        datasets: [
                            { label: 'Trajetória', data: [], borderColor: '#B3A492', backgroundColor: '#B3A492', showLine: true, tension: 0.1, pointRadius: 5 },
                            { label: 'Vértices', data: [{x:0, y:0}, {x:1, y:0}, {x:0.5, y: Math.sqrt(3)/2}], pointBackgroundColor: ['#434242', '#434242', '#434242'], pointRadius: 7, showLine: false }
                        ]
                    },
                    options: {
                        responsive: true, maintainAspectRatio: false,
                        scales: { x: { min: -0.1, max: 1.1, display: false }, y: { min: -0.1, max: 1.0, display: false } },
                        plugins: { legend: { display: false }, tooltip: { enabled: false } }
                    }
                });
                canvas.chart = tristimulusChart;
                
                function transformToTriangle(t1, t2, t3) {
                    const x = 0.5 * (2 * t2 + t3) / (t1 + t2 + t3);
                    const y = (Math.sqrt(3) / 2) * t3 / (t1 + t2 + t3);
                    return { x, y };
                }

                function getTrajectory(instrumentData) {
                    return instrumentData.map(point => {
                        const t3 = point.x; const t1 = point.y; const t2 = 1 - t1 - t3;
                        return transformToTriangle(t1, t2, t3);
                    });
                }

                let animationFrame;
                function animateTrajectory(instrument) {
                    cancelAnimationFrame(animationFrame);
                    const trajectory = getTrajectory(tristimulusData[instrument]);
                    let progress = 0;
                    tristimulusChart.data.datasets[0].data = [];
                    tristimulusChart.update();

                    function animate() {
                        progress += 0.02; if (progress > 1) progress = 1;
                        const pointIndex = Math.floor(progress * (trajectory.length - 1));
                        const nextPointIndex = Math.ceil(progress * (trajectory.length - 1));
                        const segmentProgress = (progress * (trajectory.length-1)) - pointIndex;
                        const currentData = trajectory.slice(0, pointIndex + 1);
                        if(pointIndex < trajectory.length -1) {
                            const lastPoint = trajectory[pointIndex]; const nextPoint = trajectory[nextPointIndex];
                            currentData.push({ x: lastPoint.x + (nextPoint.x - lastPoint.x) * segmentProgress, y: lastPoint.y + (nextPoint.y - lastPoint.y) * segmentProgress });
                        }
                        tristimulusChart.data.datasets[0].data = currentData;
                        tristimulusChart.update('none');
                        if (progress < 1) animationFrame = requestAnimationFrame(animate);
                    }
                    animate();
                }

                document.getElementById('instrumentSelect').addEventListener('change', (e) => animateTrajectory(e.target.value));
                animateTrajectory('piano');
            }
            
            function initOrganizationAudio() {
                const playMonoBtn = document.getElementById('playMono');
                const playStereoBtn = document.getElementById('playStereo');
                const stopAudioBtn = document.getElementById('stopAudio');

                const voices = [
                    "A percepção não é o fim da linha, mas o próprio objetivo.",
                    "Compreender os limites da audição é uma ferramenta de poder.",
                    "A ciência psicoacústica informa o design de sintetizadores."
                ];
                
                function stopAllSpeech() { speechSynthesis.cancel(); }

                function speak(text) {
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = 'pt-BR';
                    utterance.rate = 1.0;
                    speechSynthesis.speak(utterance);
                }

                playMonoBtn.onclick = () => { stopAllSpeech(); voices.forEach(v => speak(v)); };
                playStereoBtn.onclick = () => { stopAllSpeech(); voices.forEach(v => speak(v)); };
                stopAudioBtn.onclick = stopAllSpeech;
            }

            function initInterference() {
                const interferenceSection = document.getElementById('interferencia');
                if (!interferenceSection.classList.contains('active')) return;
                const canvas = document.getElementById('dissonanceChart');
                if (canvas.chart) return;

                const dissonanceSlider = document.getElementById('dissonanceSlider');
                const dissonanceValue = document.getElementById('dissonanceValue');
                const playDissonanceBtn = document.getElementById('playDissonance');
                const dissonanceCtx = canvas.getContext('2d');
                
                const criticalBandwidth = 100;
                const dissonanceData = {
                    labels: Array.from({length: 201}, (_, i) => i),
                    values: Array.from({length: 201}, (_, i) => (i/criticalBandwidth * Math.exp(1 - i/criticalBandwidth))**0.8)
                };

                dissonanceChart = new Chart(dissonanceCtx, {
                    type: 'line',
                    data: {
                        labels: dissonanceData.labels,
                        datasets: [
                            { label: 'Nível de Dissonância (Aspereza)', data: dissonanceData.values, borderColor: '#B3A492', fill: false, pointRadius: 0 },
                            { label: 'Posição Atual', data: [], pointBackgroundColor: 'red', pointRadius: 6, type: 'scatter' }
                        ]
                    },
                    options: { responsive: true, maintainAspectRatio: false, scales: { x: { title: { display: true, text: 'Diferença de Frequência (Hz)' }}, y: { title: { display: true, text: 'Dissonância Percebida' }, min: 0, max: 1.1 } }, plugins: { legend: { display: false } } }
                });
                canvas.chart = dissonanceChart;
                
                function updateDissonanceChart(freqDiff) {
                    dissonanceValue.textContent = `${freqDiff} Hz`;
                    dissonanceChart.data.datasets[1].data = [{x: freqDiff, y: dissonanceData.values[freqDiff]}];
                    dissonanceChart.update('none');
                }

                dissonanceSlider.addEventListener('input', e => updateDissonanceChart(parseInt(e.target.value)));
                
                playDissonanceBtn.addEventListener('click', async () => {
                    await Tone.start();
                    if (!dissonanceSynth) dissonanceSynth = [new Tone.Oscillator().toDestination(), new Tone.Oscillator().toDestination()];
                    const freqDiff = parseInt(dissonanceSlider.value);
                    dissonanceSynth[0].frequency.value = dissonanceBaseFreq;
                    dissonanceSynth[1].frequency.value = dissonanceBaseFreq + freqDiff;
                    dissonanceSynth.forEach(s => s.start());
                    setTimeout(() => dissonanceSynth.forEach(s => s.stop()), 1000);
                });
                updateDissonanceChart(5);

                const playSignalBtn = document.getElementById('playSignal');
                const playSignalAndMaskBtn = document.getElementById('playSignalAndMask');
                const stopMaskBtn = document.getElementById('stopMaskAudio');
                const maskResultEl = document.getElementById('maskResult');
                
                playSignalBtn.addEventListener('click', async () => {
                    await Tone.start(); clearTimeout(maskStopTimer); if(maskNoise) maskNoise.stop();
                    if(!maskSignal) maskSignal = new Tone.Oscillator(4000, "sine").toDestination();
                    maskSignal.volume.value = -25; maskSignal.start(); maskResultEl.textContent = "";
                    maskStopTimer = setTimeout(() => maskSignal.stop(), 1500);
                });
                
                playSignalAndMaskBtn.addEventListener('click', async () => {
                    await Tone.start(); clearTimeout(maskStopTimer);
                    if(!maskSignal) maskSignal = new Tone.Oscillator(4000, "sine").toDestination();
                    if(!maskNoise) maskNoise = new Tone.Noise("pink").toDestination();
                    maskSignal.volume.value = -25; maskNoise.volume.value = -10;
                    maskSignal.start(); maskNoise.start(); maskResultEl.textContent = "O sinal agudo foi mascarado?";
                    maskStopTimer = setTimeout(() => { maskSignal.stop(); maskNoise.stop(); maskResultEl.textContent = ""; }, 2000);
                });

                stopMaskBtn.addEventListener('click', () => {
                    clearTimeout(maskStopTimer); if(maskSignal) maskSignal.stop(); if(maskNoise) maskNoise.stop();
                    maskResultEl.textContent = "";
                });
            }

            function initSpace() {
                itdSliderEl = document.getElementById('itdSlider');
                const itdValueEl = document.getElementById('itdValue');
                const playItdBtn = document.getElementById('playITD');
                itdIndicator = document.getElementById('soundSourceIndicator');
                itdPositionEl = document.getElementById('itdPosition');

                itdSliderEl.addEventListener('input', e => {
                    const delayMs = parseFloat(e.target.value);
                    itdValueEl.textContent = `${Math.abs(delayMs).toFixed(2)} ms`;
                    itdIndicator.style.left = `${(delayMs + 1) / 2 * 100}%`;
                    if (delayMs < -0.7) itdPositionEl.textContent = 'Extrema Esquerda';
                    else if (delayMs < -0.1) itdPositionEl.textContent = 'Esquerda';
                    else if (delayMs > 0.7) itdPositionEl.textContent = 'Extrema Direita';
                    else if (delayMs > 0.1) itdPositionEl.textContent = 'Direita';
                    else itdPositionEl.textContent = 'Centro';
                });

                playItdBtn.addEventListener('click', async () => {
                    await Tone.start();
                    if (!itdPlayer) {
                        const merger = new Tone.Merger().toDestination();
                        itdPlayer = { noise: new Tone.Noise("white").start(), env: new Tone.AmplitudeEnvelope({ attack: 0.001, decay: 0.05, sustain: 0, release: 0.1 }), splitter: new Tone.Splitter(), delayL: new Tone.Delay(0), delayR: new Tone.Delay(0) };
                        itdPlayer.noise.connect(itdPlayer.env); itdPlayer.env.connect(itdPlayer.splitter);
                        itdPlayer.splitter.connect(itdPlayer.delayL, 0); itdPlayer.splitter.connect(itdPlayer.delayR, 1);
                        itdPlayer.delayL.connect(merger, 0, 0); itdPlayer.delayR.connect(merger, 0, 1);
                    }
                    const delayMs = parseFloat(itdSliderEl.value); const delaySec = Math.abs(delayMs / 1000);
                    itdPlayer.delayL.delayTime.value = delayMs > 0 ? delaySec : 0;
                    itdPlayer.delayR.delayTime.value = delayMs < 0 ? delaySec : 0;
                    itdPlayer.env.triggerAttackRelease("0.05s");
                });
            }
            
            // Lazy-load charts
            const observer = new IntersectionObserver((entries, obs) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const sectionId = entry.target.id;
                        if (sectionId === 'limiares') initLoudnessChart();
                        if (sectionId === 'timbre') initTimbre();
                        if (sectionId === 'organizacao') initOrganizationAudio();
                        if (sectionId === 'interferencia') initInterference();
                        if (sectionId === 'espaco') initSpace();
                        // obs.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.1 });

            contentSections.forEach(section => observer.observe(section));
            
            // Initialize first section
            initLoudnessChart();
        });
    </script>

</body>
</html>
